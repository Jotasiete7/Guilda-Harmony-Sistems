<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmony SatView</title>
    
    <!-- FAVICON -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ∞Ô∏è</text></svg>">
    
    <!-- Leaflet & Fonts -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- GENERAL STYLES --- */
        body { margin: 0; background: #121212; font-family: 'Inter', sans-serif; overflow: hidden; }
        #map { width: 100vw; height: 100vh; background: #0e0e0e; cursor: crosshair; }

        /* SIDEBAR */
        .sidebar { 
            position: absolute; top: 20px; left: 20px; width: 260px; 
            display: flex; flex-direction: column; gap: 10px; z-index: 1000; 
            max-height: 95vh; 
        }
        
        /* GLASS BOXES */
        .glass-box { 
            background: rgba(15, 15, 15, 0.95); backdrop-filter: blur(10px); 
            padding: 12px; border-radius: 8px; color: #e0e0e0; 
            border: 1px solid #333; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        
        .brand-box { text-align: center; border-top: 3px solid #00e676; } /* Neon Green Border */
        .brand-title { color: #fff; font-weight: 800; font-size: 18px; margin: 0; letter-spacing: -0.5px; }
        .brand-sub { font-size: 10px; text-transform: uppercase; color: #00e676; letter-spacing: 2px; margin-top: 2px; }

        /* CREDITS */
        .credits-box {
            font-size: 10px; color: #666; text-align: center; padding: 8px;
            background: rgba(0,0,0,0.8); border-radius: 8px; margin-top: auto;
        }
        .guild-name { color: #ffc107; font-weight: bold; }
        
        /* EDIT BUTTON */
        .edit-btn {
            background: #222; color: #ccc; border: 1px solid #444; padding: 12px; width: 100%;
            border-radius: 6px; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: 0.2s;
        }
        .edit-btn:hover { background: #333; color: #fff; }
        .edit-btn.active { 
            background: #00e676; color: #000; border-color: #00e676; /* Neon Green Active */
            box-shadow: 0 0 15px rgba(0, 230, 118, 0.4); 
        }

        /* MODAL */
        #modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #181818; padding: 20px; border-radius: 12px; width: 320px; z-index: 2000;
            border: 1px solid #444; box-shadow: 0 20px 50px rgba(0,0,0,0.9);
        }
        .modal-header { font-weight: bold; color: #fff; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; display:flex; justify-content:space-between; align-items:center; }
        .form-group { margin-bottom: 12px; }
        .form-label { display: block; font-size: 11px; color: #888; margin-bottom: 5px; text-transform: uppercase; font-weight: bold; }
        .form-input, .form-select { width: 100%; padding: 10px; background: #252525; border: 1px solid #444; color: #fff; border-radius: 6px; box-sizing: border-box; outline:none; font-size: 13px; }
        .form-input:focus, .form-select:focus { border-color: #00e676; }
        
        /* SLIDER */
        .range-wrapper { background: #222; padding: 10px; border-radius: 6px; border: 1px solid #333; }
        .range-slider { width: 100%; cursor: pointer; accent-color: #00e676; height: 5px; }
        .range-value { font-size: 11px; color: #00e676; text-align: right; margin-top: 5px; font-weight: bold; }

        /* BUTTONS */
        .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
        .btn-save { background: #00e676; color: #000; border: none; padding: 10px; flex: 1; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-save:hover { background: #00c853; }
        .btn-cancel { background: transparent; color: #aaa; border: 1px solid #444; padding: 10px; flex: 0.5; border-radius: 6px; cursor: pointer; }
        .btn-cancel:hover { color: #fff; border-color: #666; }

        /* UI FILTERS */
        .filter-row { display: flex; align-items: center; margin-bottom: 6px; font-size: 13px; cursor: pointer; color: #bbb; }
        .filter-row:hover { color: #fff; }
        .f-icon { width: 20px; text-align: center; margin-right: 8px; }
        
        .coord-box { 
            position: absolute; bottom: 20px; left: 20px; z-index: 1000; 
            font-family: monospace; font-size: 14px; color: #00e676; 
            background: #000; padding: 5px 10px; border-radius: 4px; border: 1px solid #333; 
        }
        
        /* MAP ICONS (HIGH CONTRAST) */
        .map-icon { 
            font-size: 24px; text-align: center; 
            /* Borda preta grossa (Stroke) via CSS text-shadow para destacar no verde */
            text-shadow: 
                -1px -1px 0 #000,  
                 1px -1px 0 #000,
                -1px  1px 0 #000,
                 1px  1px 0 #000,
                 0px 3px 5px rgba(0,0,0,1); 
            transition: transform 0.2s; 
        }
        .map-icon:hover { transform: scale(1.4); z-index: 999; }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: #000; text-transform: uppercase; display: inline-block; margin-top: 3px; }

    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="glass-box brand-box">
            <h1 class="brand-title">HARMONY <span style="color:#00e676">SATVIEW</span></h1>
            <div class="brand-sub">Monitoring System</div>
        </div>

        <!-- EDIT MODE -->
        <div class="glass-box">
            <button id="btnEditMode" class="edit-btn" onclick="toggleEditMode()">
                <span id="editIcon">‚úèÔ∏è</span> <span id="editText">View Mode</span>
            </button>
        </div>

        <!-- LAYERS -->
        <div class="glass-box">
            <div style="font-weight:bold; font-size:10px; color:#666; margin-bottom:10px; text-transform:uppercase; letter-spacing:1px;">Layers</div>
            <label class="filter-row" style="color:#81c784"><input type="checkbox" checked onchange="toggleGroup('deeds_active')"> <span class="f-icon">üè†</span> Active Deeds</label>
            <label class="filter-row" style="color:#9e9e9e"><input type="checkbox" checked onchange="toggleGroup('deeds_fallen')"> <span class="f-icon">ü™¶</span> History / Ruins</label>
            <label class="filter-row"><input type="checkbox" checked onchange="toggleGroup('rift')"> <span class="f-icon">üåÄ</span> Rifts</label>
            <div style="border-top:1px solid #333; margin:5px 0;"></div>
            <label class="filter-row" style="color:#00e676"><input type="checkbox" checked onchange="toggleGroup('botany')"> <span class="f-icon">üå≤</span> Botany (Flora)</label>
            <label class="filter-row"><input type="checkbox" checked onchange="toggleGroup('mobs')"> <span class="f-icon">üêæ</span> Fauna</label>
        </div>
        
        <!-- EXPORT -->
        <div class="glass-box" style="padding:8px;">
             <button onclick="exportarDados()" style="width:100%; background:transparent; border:1px dashed #444; color:#666; padding:5px; cursor:pointer; font-size:10px; border-radius: 4px;">
                üíæ Export Data (JSON)
             </button>
        </div>

        <!-- GUILD SIGNATURE -->
        <div class="credits-box">
            Dev by <span class="guild-name">A GUILDA</span><br>
            Harmony Server ‚Ä¢ 2025
        </div>
    </div>

    <!-- COORDS -->
    <div class="coord-box"><span id="coords">0, 0</span></div>

    <!-- MODAL -->
    <div id="modal">
        <div class="modal-header">
            <span>üìç Add Marker</span>
            <span style="cursor:pointer; color:#666" onclick="fecharModal()">‚úï</span>
        </div>
        
        <div class="form-group">
            <label class="form-label">Category</label>
            <select id="inputType" class="form-select" onchange="atualizarFormulario()">
                <option value="deed">üè† Active Deed</option>
                <option value="ruin">ü™¶ History / Ruin</option>
                <option value="tree">üå≤ Tree (Sprout)</option>
                <option value="bush">üåø Bush (Seedling)</option>
                <option value="rift">üåÄ Rift</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label" id="nameLabel">Name / Type</label>
            <!-- Text Input -->